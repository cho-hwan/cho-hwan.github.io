<div class="album-container">
  
  <div class="album-nav-box">
    <h2 class="nav-title">Album Categories</h2>
    <ul class="nav-list">
      {% for category in site.data.album.categories %}
        <li>
            <a href="#{{ category.id | slugify }}" class="main-link">{{ category.name }}</a>
            {% if category.subcategories %}
                <ul class="sub-nav">
                    {% for subcategory in category.subcategories %}
                        <li><a href="#{{ subcategory.id | slugify }}" class="sub-link">{{ subcategory.name }}</a></li>
                    {% endfor %}
                </ul>
            {% endif %}
        </li>
      {% endfor %}
    </ul>
  </div>

  {% for category in site.data.album.categories %}
    <div class="category-group">
        <h2 class="category-header" id="{{ category.id | slugify }}">{{ category.name }}</h2>
        <hr class="category-divider">
        
        {% if category.subcategories %}
            {% for subcategory in category.subcategories %}
                <h3 class="subcategory-header" id="{{ subcategory.id | slugify }}">{{ subcategory.name }}</h3>
                
                <div class="album-grid">
                    {% for item in subcategory.images %}
                        <div class="album-card">
                            <div class="slideshow-container" data-index="0">
                                {% for image in item.image_list %}
                                    <div class="slide">
                                        <img src="{{ image.link }}" alt="{{ item.description }}">
                                    </div>
                                {% endfor %}
                                
                                {% if item.image_list.size > 1 %}
                                    <button type="button" class="prev" onclick="changeSlide(this, -1)">&#10094;</button>
                                    <button type="button" class="next" onclick="changeSlide(this, 1)">&#10095;</button>
                                {% endif %}
                            </div>
                            <div class="card-content">
                                <p class="card-desc">{{ item.description }}</p>
                                <p class="card-date">{{ item.date }}</p>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% endfor %}
        
        {% else %}
            <div class="album-grid">
                {% for item in category.images %}
                    <div class="album-card">
                        <div class="slideshow-container" data-index="0">
                            {% for image in item.image_list %}
                                <div class="slide">
                                    <img src="{{ image.link }}" alt="{{ item.description }}">
                                </div>
                            {% endfor %}
                            
                            {% if item.image_list.size > 1 %}
                                <a class="prev" onclick="changeSlide(this, -1)">&#10094;</a>
                                <a class="next" onclick="changeSlide(this, 1)">&#10095;</a>
                            {% endif %}
                        </div>
                        <div class="card-content">
                            <p class="card-desc">{{ item.description }}</p>
                            <p class="card-date">{{ item.date }}</p>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    </div>
  {% endfor %}
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
  let slideshows = document.querySelectorAll(".slideshow-container");
  slideshows.forEach((slideshow) => {
    let slides = slideshow.querySelectorAll(".slide");
    if(slides.length > 0) {
        slides.forEach((slide, i) => {
            slide.style.opacity = (i === 0) ? "1" : "0";
            slide.style.zIndex = (i === 0) ? "1" : "0";
        });
        slideshow.dataset.index = 0;
    }
  });
});

function changeSlide(button, n) {
  let slideshow = button.parentElement;
  let slides = slideshow.querySelectorAll(".slide");
  let currentIndex = parseInt(slideshow.dataset.index);

  slides[currentIndex].style.opacity = "0";
  slides[currentIndex].style.zIndex = "0";

  currentIndex += n;
  if (currentIndex >= slides.length) { currentIndex = 0; }  
  if (currentIndex < 0) { currentIndex = slides.length - 1; }  

  slides[currentIndex].style.opacity = "1";
  slides[currentIndex].style.zIndex = "1";
  
  slideshow.dataset.index = currentIndex;
}
</script>

<style>
/* 전체 레이아웃 */
.album-container { max-width: 1200px; margin: 0 auto; padding: 20px; }

/* 네비게이션 박스 */
.album-nav-box {
  background-color: #f8f9fa;
  border: 1px solid #e9ecef;
  border-radius: 8px;
  padding: 20px;
  margin-bottom: 40px;
}
.nav-title { font-size: 1.5rem; font-weight: bold; margin-bottom: 15px; border-bottom: none; }
.nav-list { list-style: none; padding-left: 0; margin: 0; }
.nav-list li { margin-bottom: 5px; }
.sub-nav { list-style: circle; margin-left: 20px; margin-top: 5px; }
.main-link { font-weight: 600; color: #0056b3; text-decoration: none; }
.sub-link { color: #495057; text-decoration: none; font-size: 0.95em; }

/* 카테고리 헤더 */
.category-group { margin-bottom: 60px; }
.category-header { font-size: 1.75rem; font-weight: bold; margin-top: 0; margin-bottom: 10px; color: #333; }
.category-divider { border: 0; border-top: 1px solid #ccc; margin-bottom: 30px; }
.subcategory-header { font-size: 1.4rem; font-weight: 600; margin-bottom: 20px; color: #555; border-left: 4px solid #0056b3; padding-left: 10px; }

/* ★ 3열 그리드 복구 ★ */
.album-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr); /* 3개씩 배치 */
  gap: 25px; /* 적당한 간격 */
}

/* 반응형 처리 */
@media (max-width: 900px)  { .album-grid { grid-template-columns: repeat(2, 1fr); } }
@media (max-width: 600px)  { .album-grid { grid-template-columns: 1fr; } }

/* 카드 스타일 */
.album-card {
  background: white;
  border: 1px solid #ddd;
  border-radius: 8px;
  overflow: hidden;
  box-shadow: 0 3px 6px rgba(0,0,0,0.06);
  display: flex;
  flex-direction: column;
}

/* ★ 사진 비율 및 크기 조정 (핵심 수정) ★ */
.slideshow-container {
  position: relative;
  width: 100%;
  /* 기존 75%(4:3) -> 66.66%(3:2) 로 변경 */
  /* 이렇게 하면 세로 높이가 조금 줄어들면서 가로로 긴 사진이 덜 잘리게 됩니다. */
  padding-top: 66.66%; 
  background: #f0f0f0; /* 이미지가 로딩되기 전 배경색 */
  overflow: hidden;
}

.slide {
  position: absolute;
  top: 0; left: 0; width: 100%; height: 100%;
  transition: opacity 0.4s ease;
  background: #fff;
}

/* ★ 이미지 맞춤 방식 개선 ★ */
.slide img { 
  width: 100%; 
  height: 100%; 
  /* cover: 꽉 채우기 (여백 없음, 일부 잘림) */
  /* contain: 다 보여주기 (여백 생김, 안 잘림) */
  /* 현재 요청하신 "조금이라도 축소해서 넓게"는 cover 상태에서 비율을 3:2로 바꾸는 것이 가장 깔끔합니다. */
  object-fit: cover; 
  object-position: center center; /* 사진의 중앙을 기준으로 정렬 */
}

/* 화살표 버튼 */
.prev, .next {
  cursor: pointer;
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  padding: 10px 15px;
  color: white;
  font-weight: bold;
  font-size: 20px;
  z-index: 10;
  user-select: none;
  border-radius: 4px;

  /* ★ 버튼 기본 스타일 제거 및 복구 ★ */
  background-color: rgba(0,0,0,0.2); /* 배경색 다시 지정 */
  border: none;                     /* 회색 테두리 제거 */
  outline: none;                    /* 클릭 시 생기는 파란 테두리 제거 */
  appearance: none;                 /* 브라우저 기본 외형 제거 */
  display: flex;                    /* 화살표 중앙 정렬 */
  align-items: center;
  justify-content: center;
}

.next { right: 5px; }
.prev { left: 5px; }

.prev:hover, .next:hover { 
  background-color: rgba(0,0,0,0.7); 
  color: white; /* 텍스트 색상 유지 */
}

/* 카드 내용 */
.card-content { padding: 15px; flex-grow: 1; display: flex; flex-direction: column; justify-content: space-between; }
.card-desc { font-size: 1.05rem; font-weight: 600; margin-bottom: 8px; line-height: 1.35; color: #333; }
.card-date { font-size: 0.85rem; color: #888; margin: 0; }
</style>
